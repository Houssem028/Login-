<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© - ASH</title>

<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>

<style>
body{font-family:Arial;background:#f5f7fa;margin:0;padding:20px}
header{background:#0a5cff;color:#fff;padding:15px;text-align:center;border-radius:10px}
h2{text-align:center;color:#0a5cff;margin-top:40px}
.box{background:#fff;padding:15px;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,.08);overflow-x:auto}
table{width:100%;border-collapse:collapse;min-width:900px}
th,td{border:1px solid #ddd;padding:8px;text-align:center;font-size:14px}
th{background:#0a5cff;color:#fff}
tr:nth-child(even){background:#f9f9f9}
.badge{padding:4px 8px;border-radius:6px;color:#fff;font-size:12px}
.new{background:#28a745}
.done{background:#0a5cff}
.cancel{background:#f44336}
select,button{padding:5px;border-radius:6px;border:1px solid #ccc;cursor:pointer}
.btn-del{background:#f44336;color:#fff;border:none}
</style>
</head>

<body>

<header>
  <h1>Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© ASH</h1>
  <p>Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ùˆ ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ø§Ù„Ø²Ø¨Ø§Ø¦Ù†</p>
</header>

<!-- ===== Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª ===== -->
<h2>ğŸ“… Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª</h2>
<div class="box">
<table>
<thead>
<tr>
<th>Ø§Ù„Ø§Ø³Ù…</th>
<th>Ø§Ù„Ù‡Ø§ØªÙ</th>
<th>Ø§Ù„Ø®Ø¯Ù…Ø©</th>
<th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th>
<th>Ø§Ù„ÙŠÙˆÙ…</th>
<th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
<th>Ø§Ù„ÙˆÙ‚Øª</th>
<th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
<th>ØªØ¹Ø¯ÙŠÙ„</th>
</tr>
</thead>
<tbody id="bookings-body"></tbody>
</table>
</div>

<!-- ===== Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª ===== -->
<h2>â­ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª</h2>
<div class="box">
<table>
<thead>
<tr>
<th>Ø§Ù„Ø§Ø³Ù…</th>
<th>Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„</th>
<th>Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</th>
<th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
<th>Ø­Ø°Ù</th>
</tr>
</thead>
<tbody id="ratings-body"></tbody>
</table>
</div>

<script>
const firebaseConfig={
 apiKey:"AIzaSyAJxzFknapSh0fnPfIXwEEK3OijSKlqxco",
 authDomain:"admin-ash-f622c.firebaseapp.com",
 projectId:"admin-ash-f622c"
};
firebase.initializeApp(firebaseConfig);
const db=firebase.firestore();

function fmt(ts){
 const d=new Date(ts||Date.now());
 return{
  day:d.toLocaleDateString('ar-TN',{weekday:'long'}),
  date:d.toLocaleDateString('ar-TN'),
  time:d.toLocaleTimeString('ar-TN')
 };
}

// ===== Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª =====
db.collection("bookings").orderBy("createdAt","desc")
.onSnapshot(snap=>{
 const body=document.getElementById("bookings-body");
 body.innerHTML="";
 snap.forEach(doc=>{
  const d=doc.data();
  const t=fmt(d.createdAt);
  body.innerHTML+=`
  <tr>
   <td>${d.name}</td>
   <td>${d.phone}</td>
   <td>${d.service}</td>
   <td>${d.address}</td>
   <td>${t.day}</td>
   <td>${t.date}</td>
   <td>${t.time}</td>
   <td>
    <span class="badge ${d.status==='ØªÙ…'?'done':d.status==='Ù…Ù„ØºÙŠ'?'cancel':'new'}">
     ${d.status||'Ø¬Ø¯ÙŠØ¯'}
    </span>
   </td>
   <td>
    <select onchange="updateStatus('${doc.id}',this.value)">
     <option>Ø¬Ø¯ÙŠØ¯</option>
     <option>ØªÙ…</option>
     <option>Ù…Ù„ØºÙŠ</option>
    </select>
   </td>
  </tr>`;
 });
});

function updateStatus(id,val){
 db.collection("bookings").doc(id).update({status:val});
}

// ===== Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª =====
db.collection("ratings").orderBy("timestamp","desc")
.onSnapshot(snap=>{
 const body=document.getElementById("ratings-body");
 body.innerHTML="";
 snap.forEach(doc=>{
  const d=doc.data();
  const t=fmt(d.timestamp);
  body.innerHTML+=`
  <tr>
   <td>${d.name}</td>
   <td>${d.email||'-'}</td>
   <td>${'â­'.repeat(d.rating)}</td>
   <td>${t.date} ${t.time}</td>
   <td>
    <button class="btn-del" onclick="delRating('${doc.id}')">Ø­Ø°Ù</button>
   </td>
  </tr>`;
 });
});

function delRating(id){
 if(confirm("Ø­Ø°Ù Ø§Ù„ØªÙ‚ÙŠÙŠÙ…ØŸ")){
  db.collection("ratings").doc(id).delete();
 }
}
</script>

</body>
</html>
