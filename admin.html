<!doctype html>
<html lang="fr" dir="ltr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Admin - ASH Window Cleaning</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:'Poppins',Arial,sans-serif;}
body{background:#f5f7fa;color:#333;padding:20px;}
h2{text-align:center;color:#0a3cff;margin:40px 0;}
table{width:100%;border-collapse:collapse;background:#fff;box-shadow:0 4px 10px rgba(0,0,0,.08);border-radius:8px;overflow:hidden;margin-top:20px;}
th,td{border:1px solid #ddd;padding:8px;text-align:center;font-size:14px;}
th{background:#0a3cff;color:#fff;}
tr:nth-child(even){background:#f9f9f9;}
input[type="number"]{width:80px;padding:4px;border-radius:4px;border:1px solid #ccc;}
input[type="checkbox"]{transform:scale(1.3);}
.total-box{margin-top:15px;font-size:18px;font-weight:bold;color:#1f2933;}
.section-box{margin-bottom:50px;}
</style>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
</head>

<body>
<h2>ğŸ“… Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª</h2>
<div class="section-box">
<table>
<thead>
<tr>
<th>Ø§Ù„ÙŠÙˆÙ…</th>
<th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
<th>Ø§Ù„ÙˆÙ‚Øª</th>
<th>Ø§Ù„Ø§Ø³Ù…</th>
<th>Ø§Ù„Ù‡Ø§ØªÙ</th>
<th>Ø§Ù„Ø®Ø¯Ù…Ø©</th>
<th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th>
<th>Ø§Ù„Ù…Ø¨Ù„Øº (DT)</th>
<th>ØªÙ… Ø§Ù„Ø¹Ù…Ù„</th>
</tr>
</thead>
<tbody id="bookings"></tbody>
</table>
<div class="total-box">
ğŸ’° Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ Ù„Ù„Ø£Ø¹Ù…Ø§Ù„ Ø§Ù„Ù…Ù†Ø¬Ø²Ø©: <span id="total-amount">0 DT</span>
</div>
</div>

<h2>â­ ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ø§Ù„Ø²Ø¨Ø§Ø¦Ù†</h2>
<div class="section-box">
<table>
<thead>
<tr>
<th>Ø§Ù„Ø§Ø³Ù…</th>
<th>Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„</th>
<th>Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</th>
<th>Ø§Ù„ÙˆÙ‚Øª</th>
</tr>
</thead>
<tbody id="ratings"></tbody>
</table>
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyAJxzFknapSh0fnPfIXwEEK3OijSKlqxco",
  authDomain: "admin-ash-f622c.firebaseapp.com",
  projectId: "admin-ash-f622c",
  storageBucket: "admin-ash-f622c.appspot.com",
  messagingSenderId: "76505742154",
  appId: "1:76505742154:web:dc4f190f9f2de80acb1fb3",
  measurementId: "G-MNPL104YPN"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// ===== Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª =====
db.collection("bookings").orderBy("date","desc").onSnapshot(snapshot=>{
  const tbody=document.getElementById("bookings");
  tbody.innerHTML="";
  let total=0;
  snapshot.forEach(doc=>{
    const d=doc.data();
    const dayName=d.date?new Date(d.date).toLocaleDateString("ar-TN",{weekday:"long"}):"-";
    const checked=d.done?"checked":"";
    const amount=d.amount||"";
    if(d.done && d.amount){total+=Number(d.amount);}
    tbody.innerHTML+=`<tr>
      <td>${dayName}</td>
      <td>${d.date||"-"}</td>
      <td>${d.time||"-"}</td>
      <td>${d.name}</td>
      <td>${d.phone}</td>
      <td>${d.service}</td>
      <td>${d.address}</td>
      <td><input type="number" min="0" value="${amount}" onchange="updateAmount('${doc.id}', this.value)"></td>
      <td><input type="checkbox" ${checked} onchange="toggleDone('${doc.id}', this.checked)"></td>
    </tr>`;
  });
  document.getElementById("total-amount").textContent=total+" DT";
});

function toggleDone(id,val){
  db.collection("bookings").doc(id).update({done:val});
}
function updateAmount(id,val){
  db.collection("bookings").doc(id).update({amount:Number(val)});
}

// ===== Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª =====
db.collection("ratings").orderBy("timestamp","desc").onSnapshot(snapshot=>{
  const tbody=document.getElementById("ratings");
  tbody.innerHTML="";
  snapshot.forEach(doc=>{
    const d=doc.data();
    const time=d.timestamp?new Date(d.timestamp.seconds*1000).toLocaleString("ar-TN"):"-";
    tbody.innerHTML+=`<tr>
      <td>${d.name}</td>
      <td>${d.email||"-"}</td>
      <td>${"â­".repeat(d.rating)}</td>
      <td>${time}</td>
    </tr>`;
  });
});
</script>
</body>
</html>
