<!doctype html>
<html lang="fr" dir="ltr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Administration - ASH Window Cleaning</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>

<style>
/* ===== Reset ===== */
* { box-sizing:border-box; margin:0; padding:0; font-family:'Poppins',Arial,sans-serif; }
body { background: #f4f7fb; color:#333; line-height:1.6; }

/* ===== Header ===== */
header {
  background: linear-gradient(90deg,#0a3cff,#00c897);
  color:#fff; padding:15px 20px; text-align:center; box-shadow:0 6px 20px rgba(0,0,0,0.18);
}
header h1 { font-size:24px; }

/* ===== Container ===== */
.container { max-width:1200px; margin:20px auto; padding:0 20px; }

/* ===== Table ===== */
.card { background:#fff; border-radius:12px; padding:20px; box-shadow:0 10px 30px rgba(0,0,0,0.08); margin-bottom:30px; overflow-x:auto; }
table { width:100%; border-collapse:collapse; }
th,td { padding:12px; border-bottom:1px solid #eee; text-align:center; }
th { background:#0a3cff; color:#fff; }
tr:hover { background: rgba(10,60,255,0.05); }

/* ===== Inputs ===== */
input[type="number"] { width:80px; padding:6px; border-radius:6px; border:1px solid #ddd; }
input[type="checkbox"] { transform:scale(1.2); }

/* ===== Titles ===== */
h2 { margin-bottom:15px; color:#0a3cff; text-align:center; }

/* ===== Responsive ===== */
@media(max-width:768px){ table { font-size:14px; } input[type="number"]{ width:60px; } }
</style>

</head>
<body>

<header>
  <h1>ASH Window Cleaning - Administration</h1>
</header>

<div class="container">

  <!-- R√©servations -->
  <div class="card">
    <h2>üìÖ R√©servations</h2>
    <table>
      <thead>
        <tr>
          <th>Date</th>
          <th>Jour</th>
          <th>Heure</th>
          <th>Nom</th>
          <th>T√©l√©phone</th>
          <th>Service</th>
          <th>Adresse</th>
          <th>Montant (DT)</th>
          <th>Travail effectu√©</th>
        </tr>
      </thead>
      <tbody id="bookings"></tbody>
    </table>
  </div>

  <!-- √âvaluations -->
  <div class="card">
    <h2>‚≠ê √âvaluations des clients</h2>
    <table>
      <thead>
        <tr>
          <th>Nom</th>
          <th>Email</th>
          <th>√âvaluation</th>
          <th>Horodatage</th>
        </tr>
      </thead>
      <tbody id="ratings"></tbody>
    </table>
  </div>

</div>

<script>
// Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyAJxzFknapSh0fnPfIXwEEK3OijSKlqxco",
  authDomain: "admin-ash-f622c.firebaseapp.com",
  projectId: "admin-ash-f622c",
  storageBucket: "admin-ash-f622c.appspot.com",
  messagingSenderId: "76505742154",
  appId: "1:76505742154:web:dc4f190f9f2de80acb1fb3",
  measurementId: "G-MNPL104YPN"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// ===== R√©servations =====
db.collection("bookings").orderBy("date","desc").onSnapshot(snapshot => {
  const tbody = document.getElementById("bookings");
  tbody.innerHTML = "";
  snapshot.forEach(doc => {
    const d = doc.data();
    const day = d.date ? new Date(d.date).toLocaleDateString("fr-FR",{ weekday:"long" }) : "-";
    const done = d.done ? "checked" : "";
    const amount = d.amount || "";
    tbody.innerHTML += `
      <tr>
        <td>${d.date || "-"}</td>
        <td>${day}</td>
        <td>${d.time || "-"}</td>
        <td>${d.name}</td>
        <td>${d.phone}</td>
        <td>${d.service}</td>
        <td>${d.address}</td>
        <td><input type="number" min="0" value="${amount}" onchange="updateAmount('${doc.id}', this.value)"></td>
        <td><input type="checkbox" ${done} onchange="toggleDone('${doc.id}', this.checked)"></td>
      </tr>
    `;
  });
});

// Mettre √† jour le statut du travail
function toggleDone(id,val){
  db.collection("bookings").doc(id).update({ done: val });
}

// Mettre √† jour le montant
function updateAmount(id,val){
  db.collection("bookings").doc(id).update({ amount: Number(val) });
}

// ===== √âvaluations =====
db.collection("ratings").orderBy("timestamp","desc").onSnapshot(snapshot => {
  const tbody = document.getElementById("ratings");
  tbody.innerHTML = "";
  snapshot.forEach(doc => {
    const d = doc.data();
    const ts = d.timestamp ? new Date(d.timestamp).toLocaleString("fr-FR") : "-";
    tbody.innerHTML += `
      <tr>
        <td>${d.name}</td>
        <td>${d.email || "-"}</td>
        <td>${"‚≠ê".repeat(d.rating)}</td>
        <td>${ts}</td>
      </tr>
    `;
  });
});
</script>

</body>
</html>
