<!doctype html>
<html lang="fr" dir="ltr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Tableau de bord - ASH</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>

<style>
body {
  font-family: 'Poppins', Arial, sans-serif;
  background: #f5f7fa;
  margin:0; padding:0;
}
header {
  background: linear-gradient(90deg,#0a3cff,#00c897);
  color:#fff;
  text-align:center;
  padding:25px 0;
  font-size:22px;
  font-weight:700;
  box-shadow:0 6px 20px rgba(0,0,0,0.18);
}
.container {
  max-width:1200px;
  margin:30px auto;
  padding:20px;
}
h2 { color:#0a3cff; margin-bottom:15px; text-align:center; }

table {
  width:100%;
  border-collapse:collapse;
  background:#fff;
  border-radius:10px;
  overflow:hidden;
  box-shadow:0 8px 25px rgba(0,0,0,0.1);
  margin-bottom:40px;
}
th, td {
  border:1px solid #ddd;
  padding:10px;
  text-align:center;
  font-size:14px;
}
th { background:#0a3cff; color:white; }
input[type="text"], input[type="number"], input[type="email"], input[type="date"], input[type="time"], select {
  width:100%;
  padding:6px;
  box-sizing:border-box;
  border-radius:6px;
  border:1px solid #ccc;
}
input[type="checkbox"] { transform:scale(1.3); cursor:pointer; }
button { 
  background: linear-gradient(90deg,#0a3cff,#00c897); 
  color:#fff; 
  border:none; 
  padding:8px 14px; 
  border-radius:6px; 
  cursor:pointer; 
  font-weight:700; 
  transition:0.2s;
}
button:hover { transform:translateY(-2px); box-shadow:0 6px 15px rgba(0,0,0,0.2);}
.total-box{
  font-size:18px; font-weight:700; color:#1f2933; text-align:right; margin-bottom:40px;
}
</style>
</head>

<body>
<header>ASH Window Cleaning - Tableau de bord</header>

<div class="container">

<h2>üìÖ R√©servations</h2>
<table>
<thead>
<tr>
  <th>Nom</th>
  <th>T√©l√©phone</th>
  <th>Email</th>
  <th>Service</th>
  <th>Adresse</th>
  <th>Date</th>
  <th>Heure</th>
  <th>Montant (DT)</th>
  <th>Travail effectu√©</th>
</tr>
</thead>
<tbody id="bookings"></tbody>
</table>

<div class="total-box">
üí∞ Total des travaux effectu√©s: <span id="total-amount">0 DT</span>
</div>

<h2>‚≠ê Avis clients</h2>
<table>
<thead>
<tr>
  <th>Nom</th>
  <th>Email</th>
  <th>Note</th>
  <th>Date</th>
</tr>
</thead>
<tbody id="ratings"></tbody>
</table>

</div>

<script>
// Config Firebase
const firebaseConfig = {
  apiKey: "AIzaSyAJxzFknapSh0fnPfIXwEEK3OijSKlqxco",
  authDomain: "admin-ash-f622c.firebaseapp.com",
  projectId: "admin-ash-f622c",
  storageBucket: "admin-ash-f622c.appspot.com",
  messagingSenderId: "76505742154",
  appId: "1:76505742154:web:dc4f190f9f2de80acb1fb3"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// =================== R√âSERVATIONS ===================
db.collection("bookings").orderBy("date","desc").onSnapshot(snapshot=>{
  const tbody = document.getElementById("bookings");
  tbody.innerHTML = "";
  let total = 0;

  snapshot.forEach(doc=>{
    const d = doc.data();
    const done = d.done ? "checked" : "";
    const amount = d.amount || "";

    if(d.done && d.amount) total += Number(d.amount);

    tbody.innerHTML += `
      <tr>
        <td><input type="text" value="${d.name}" onblur="updateBooking('${doc.id}','name',this.value)"></td>
        <td><input type="text" value="${d.phone}" onblur="updateBooking('${doc.id}','phone',this.value)"></td>
        <td><input type="email" value="${d.email || ''}" onblur="updateBooking('${doc.id}','email',this.value)"></td>
        <td>
          <select onchange="updateBooking('${doc.id}','service',this.value)">
            <option ${d.service==='Nettoyage des vitres'?'selected':''}>Nettoyage des vitres</option>
            <option ${d.service==='Nettoyage des fa√ßades'?'selected':''}>Nettoyage des fa√ßades</option>
            <option ${d.service==='Services r√©guliers'?'selected':''}>Services r√©guliers</option>
          </select>
        </td>
        <td><input type="text" value="${d.address}" onblur="updateBooking('${doc.id}','address',this.value)"></td>
        <td><input type="date" value="${d.date}" onblur="updateBooking('${doc.id}','date',this.value)"></td>
        <td><input type="time" value="${d.time}" onblur="updateBooking('${doc.id}','time',this.value)"></td>
        <td><input type="number" value="${amount}" onblur="updateBooking('${doc.id}','amount',this.value)"></td>
        <td><input type="checkbox" ${done} onchange="toggleDone('${doc.id}',this.checked)"></td>
      </tr>`;
  });

  document.getElementById("total-amount").textContent = total + " DT";
});

function updateBooking(id, field, value){
  db.collection("bookings").doc(id).update({ [field]: value })
    .then(()=> console.log("Mise √† jour r√©ussie"))
    .catch(err => console.error(err));
}

function toggleDone(id, val){
  db.collection("bookings").doc(id).update({ done: val });
}

// =================== AVIS ===================
db.collection("ratings").orderBy("timestamp","desc").onSnapshot(snapshot=>{
  const tbody = document.getElementById("ratings");
  tbody.innerHTML = "";

  snapshot.forEach(doc=>{
    const d = doc.data();
    tbody.innerHTML += `
      <tr>
        <td>${d.name}</td>
        <td>${d.email || '-'}</td>
        <td>${"‚≠ê".repeat(d.rating)}</td>
        <td>${new Date(d.timestamp).toLocaleString('fr-FR')}</td>
      </tr>`;
  });
});
</script>
</body>
</html>
