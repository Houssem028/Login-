<!doctype html>
<html lang="fr" dir="ltr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ASH Window Cleaning - Admin</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>

<style>
body{
  font-family:'Poppins',Arial,sans-serif;
  margin:0;
  background:#f4f7fb;
}
header{
  background:linear-gradient(90deg,#0a3cff,#00c897);
  color:#fff;
  padding:20px;
  text-align:center;
}
.container{
  max-width:1200px;
  margin:25px auto;
  background:#fff;
  padding:25px;
  border-radius:14px;
  box-shadow:0 10px 30px rgba(0,0,0,.08);
}
h2{
  color:#0a3cff;
  margin:30px 0 15px;
}
table{
  width:100%;
  border-collapse:separate;
  border-spacing:0 8px;
}
th{
  background:#0a3cff;
  color:#fff;
  padding:12px;
}
td{
  background:#fff;
  padding:12px;
  text-align:center;
  border-bottom:1px solid #eee;
}
tr{
  box-shadow:0 4px 12px rgba(0,0,0,.05);
}
input[type="number"]{
  width:90px;
  padding:6px;
  border-radius:6px;
  border:1px solid #ddd;
}
input[type="checkbox"]{
  transform:scale(1.2);
}
.btn{
  padding:6px 10px;
  border:none;
  border-radius:6px;
  cursor:pointer;
  font-weight:600;
}
.btn-delete{
  background:#e53935;
  color:#fff;
}
.btn-delete:hover{ background:#c62828; }

.total-box{
  text-align:right;
  font-weight:700;
  margin-top:10px;
}
</style>
</head>

<body>

<header>
  <h1>ASH Window Cleaning ‚Äì Administration</h1>
</header>

<div class="container">

<h2>üìÖ R√©servations</h2>
<table>
<thead>
<tr>
  <th>Jour</th>
  <th>Date</th>
  <th>Heure</th>
  <th>Nom</th>
  <th>T√©l√©phone</th>
  <th>Service</th>
  <th>Adresse</th>
  <th>Montant (DT)</th>
  <th>Termin√©</th>
  <th>Action</th>
</tr>
</thead>
<tbody id="bookings"></tbody>
</table>

<div class="total-box">
üí∞ Total r√©alis√© : <span id="total-amount">0 DT</span>
</div>

<h2>‚≠ê √âvaluations clients</h2>
<table>
<thead>
<tr>
  <th>Nom</th>
  <th>Email</th>
  <th>Note</th>
  <th>Date</th>
  <th>Action</th>
</tr>
</thead>
<tbody id="ratings"></tbody>
</table>

</div>

<script>
// ===== Firebase =====
const firebaseConfig = {
  apiKey: "AIzaSyAJxzFknapSh0fnPfIXwEEK3OijSKlqxco",
  authDomain: "admin-ash-f622c.firebaseapp.com",
  projectId: "admin-ash-f622c",
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// ===== BOOKINGS =====
db.collection("bookings").orderBy("date","desc").onSnapshot(snapshot=>{
  const tbody=document.getElementById("bookings");
  tbody.innerHTML="";
  let total=0;

  snapshot.forEach(doc=>{
    const d=doc.data();
    if(d.done && d.amount) total+=Number(d.amount);

    tbody.innerHTML+=`
    <tr>
      <td>${d.date ? new Date(d.date).toLocaleDateString("fr-FR",{weekday:"long"}) : "-"}</td>
      <td>${d.date||"-"}</td>
      <td>${d.time||"-"}</td>
      <td>${d.name}</td>
      <td>${d.phone}</td>
      <td>${d.service}</td>
      <td>${d.address}</td>
      <td>
        <input type="number" value="${d.amount||0}"
        onchange="updateAmount('${doc.id}',this.value)">
      </td>
      <td>
        <input type="checkbox" ${d.done?"checked":""}
        onchange="toggleDone('${doc.id}',this.checked)">
      </td>
      <td>
        <button class="btn btn-delete"
        onclick="deleteBooking('${doc.id}')">Supprimer</button>
      </td>
    </tr>`;
  });

  document.getElementById("total-amount").textContent=total+" DT";
});

function toggleDone(id,val){
  db.collection("bookings").doc(id).update({done:val});
}
function updateAmount(id,val){
  db.collection("bookings").doc(id).update({amount:Number(val)});
}
function deleteBooking(id){
  if(confirm("Supprimer cette r√©servation ?")){
    db.collection("bookings").doc(id).delete();
  }
}

// ===== RATINGS =====
db.collection("ratings").orderBy("timestamp","desc").onSnapshot(snapshot=>{
  const tbody=document.getElementById("ratings");
  tbody.innerHTML="";

  snapshot.forEach(doc=>{
    const d=doc.data();
    tbody.innerHTML+=`
    <tr>
      <td>${d.name}</td>
      <td>${d.email||"-"}</td>
      <td>${"‚≠ê".repeat(d.rating)}</td>
      <td>${new Date(d.timestamp).toLocaleString("fr-FR")}</td>
      <td>
        <button class="btn btn-delete"
        onclick="deleteRating('${doc.id}')">Supprimer</button>
      </td>
    </tr>`;
  });
});

function deleteRating(id){
  if(confirm("Supprimer ce commentaire ?")){
    db.collection("ratings").doc(id).delete();
  }
}
</script>

</body>
</html>
