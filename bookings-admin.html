<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© - ASH</title>

<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>

<style>
body{font-family:Arial;background:#f5f7fa;padding:20px}
h2{text-align:center;color:#0a5cff;margin-top:40px}
.stats{
  background:#fff;padding:15px;border-radius:10px;
  text-align:center;box-shadow:0 4px 10px rgba(0,0,0,.08)
}
table{
  width:100%;border-collapse:collapse;background:#fff;margin-top:20px;
  box-shadow:0 4px 10px rgba(0,0,0,.08)
}
th,td{border:1px solid #ddd;padding:8px;text-align:center;font-size:14px}
th{background:#0a5cff;color:#fff}
tr:nth-child(even){background:#f9f9f9}
button.delete{
  background:#e74c3c;color:#fff;border:none;
  padding:6px 10px;border-radius:6px;cursor:pointer
}
button.delete:hover{opacity:.85}
input[type="number"]{width:80px}
.total-box{margin-top:15px;font-size:18px;font-weight:bold}
</style>
</head>

<body>

<h2>ğŸ“… Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª</h2>

<table>
<thead>
<tr>
  <th>Ø§Ù„ÙŠÙˆÙ…</th>
  <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
  <th>Ø§Ù„ÙˆÙ‚Øª</th>
  <th>Ø§Ù„Ø§Ø³Ù…</th>
  <th>Ø§Ù„Ù‡Ø§ØªÙ</th>
  <th>Ø§Ù„Ø®Ø¯Ù…Ø©</th>
  <th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th>
  <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
  <th>ØªÙ… Ø§Ù„Ø¹Ù…Ù„</th>
  <th>Ø­Ø°Ù</th>
</tr>
</thead>
<tbody id="bookings"></tbody>
</table>

<div class="total-box">
ğŸ’° Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ Ø§Ù„Ù…Ù†Ø¬Ø²Ø©:
<span id="total-amount">0 DT</span>
</div>

<h2>â­ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª</h2>

<div class="stats">
Ù…Ø¹Ø¯Ù‘Ù„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…:
<strong id="avg-rating">0</strong> / 5 â­  
(<span id="rating-count">0</span> ØªÙ‚ÙŠÙŠÙ…)
</div>

<table>
<thead>
<tr>
  <th>Ø§Ù„Ø§Ø³Ù…</th>
  <th>Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„</th>
  <th>Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</th>
  <th>Ø§Ù„ÙˆÙ‚Øª</th>
  <th>Ø­Ø°Ù</th>
</tr>
</thead>
<tbody id="ratings"></tbody>
</table>

<script>
// Firebase
const firebaseConfig = {
  apiKey: "AIzaSyAJxzFknapSh0fnPfIXwEEK3OijSKlqxco",
  authDomain: "admin-ash-f622c.firebaseapp.com",
  projectId: "admin-ash-f622c",
  storageBucket: "admin-ash-f622c.appspot.com",
  messagingSenderId: "76505742154",
  appId: "1:76505742154:web:dc4f190f9f2de80acb1fb3"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// ================= Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª =================
db.collection("bookings").orderBy("date","desc").onSnapshot(snapshot=>{
  const tbody = document.getElementById("bookings");
  tbody.innerHTML = "";
  let total = 0;

  snapshot.forEach(doc=>{
    const d = doc.data();
    const day = d.date
      ? new Date(d.date).toLocaleDateString("ar-TN",{weekday:"long"})
      : "-";

    if(d.done && d.amount) total += Number(d.amount);

    tbody.innerHTML += `
    <tr>
      <td>${day}</td>
      <td>${d.date||"-"}</td>
      <td>${d.time||"-"}</td>
      <td>${d.name}</td>
      <td>${d.phone}</td>
      <td>${d.service}</td>
      <td>${d.address}</td>
      <td>
        <input type="number" value="${d.amount||""}"
        onchange="db.collection('bookings').doc('${doc.id}')
        .update({amount:Number(this.value)})">
      </td>
      <td>
        <input type="checkbox" ${d.done?"checked":""}
        onchange="db.collection('bookings').doc('${doc.id}')
        .update({done:this.checked})">
      </td>
      <td>
        <button class="delete"
        onclick="confirm('Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨ØŸ') &&
        db.collection('bookings').doc('${doc.id}').delete()">
        ğŸ—‘
        </button>
      </td>
    </tr>`;
  });

  document.getElementById("total-amount").textContent = total + " DT";
});

// ================= Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª =================
db.collection("ratings").orderBy("timestamp","desc").onSnapshot(snapshot=>{
  const tbody = document.getElementById("ratings");
  tbody.innerHTML = "";
  let sum=0,count=0;

  snapshot.forEach(doc=>{
    const d = doc.data();
    sum += d.rating;
    count++;

    tbody.innerHTML += `
    <tr>
      <td>${d.name}</td>
      <td>${d.email||"-"}</td>
      <td>${"â­".repeat(d.rating)}</td>
      <td>${new Date(d.timestamp).toLocaleString("ar-TN")}</td>
      <td>
        <button class="delete"
        onclick="confirm('Ø­Ø°Ù Ø§Ù„ØªÙ‚ÙŠÙŠÙ…ØŸ') &&
        db.collection('ratings').doc('${doc.id}').delete()">
        ğŸ—‘
        </button>
      </td>
    </tr>`;
  });

  document.getElementById("avg-rating").textContent =
    count ? (sum/count).toFixed(1) : 0;
  document.getElementById("rating-count").textContent = count;
});
</script>

</body>
</html>
